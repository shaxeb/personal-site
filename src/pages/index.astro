---
import BaseLayout from "../layouts/BaseLayout.astro";
// Remove the import if it's not used elsewhere on this page
// import NewsletterForm from "../components/NewsletterForm.astro";

// Define type for Astro Markdown post frontmatter
interface PostFrontmatter {
	title: string;
	pubDate: string; // Or Date can be used to sort posts by date
	description?: string; // description
	[key: string]: any; // Allow other frontmatter properties
}

// Define type for the module returned by import.meta.glob with eager: true
interface MarkdownPostModule {
	url?: string;
	frontmatter: PostFrontmatter;
	// Add other exports if needed, like compiledContent, etc.
	[key: string]: any;
}

// 1. Fetch all posts using import.meta.glob
// The result is an object: { './path/to/post.md': Module, ... }
const postModules: Record<string, MarkdownPostModule> = import.meta.glob(
	"./posts/*.md",
	{ eager: true },
);

// Convert the object into an array of post objects
const allPosts = Object.values(postModules);

// Sort posts by date, newest first
allPosts.sort(
	(a, b) =>
		new Date(b.frontmatter.pubDate).valueOf() -
		new Date(a.frontmatter.pubDate).valueOf(),
);
---

<BaseLayout
	title="shah.build"
	description="Shahzeb's personal blog covering everything he finds interesting"
>
	<h1 class="font-semibold mb-4">shah.build</h1>
	<p>
		I'm <a
			class="text-sky-600 hover:underline"
			href="https://x.com/shahdotbuild">Shahzeb</a
		>, a software engineer based in India and currently developing a
		Developer support solution. This is my Scratchpad where I jot down what
		I learn and find amazing.
	</p>

	<hr class="my-8 border-neutral-200" />

	<h2 class="font-semibold mb-4">Blog Posts</h2>

	{/* 2. Loop through posts and display data */}
	<div class="space-y-4">
		{/* Add spacing between post links */}
		{
			allPosts.map((post) => (
				<a
					href={post.url}
					class="block p-4 border border-neutral-200 rounded hover:bg-neutral-100 hover:border-neutral-300 transition-colors"
				>
					<h3 class="text-lg font-semibold mb-1">
						{post.frontmatter.title}
					</h3>
					<p class="text-sm text-neutral-600">
						Published:{" "}
						{new Date(post.frontmatter.pubDate).toLocaleDateString(
							"en-US",
							{
								year: "numeric",
								month: "long",
								day: "numeric",
							},
						)}
					</p>
					{/* Optional: Display description if available */}
					{post.frontmatter.description && (
						<p class="mt-2 text-neutral-700">
							{post.frontmatter.description}
						</p>
					)}
				</a>
			))
		}
	</div>
</BaseLayout>
